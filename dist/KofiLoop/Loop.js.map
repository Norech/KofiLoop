{"version":3,"sources":["../src/KofiLoop/Loop.ts"],"names":[],"mappings":"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","file":"Loop.js","sourcesContent":["\nimport { startLoop, registerLoop } from './index';\nimport {EventEmitter} from 'events';\n\n    \n/**\n * Loop status properties.\n * @internal\n * @private\n */\nexport interface LoopStatus\n{\n    isStopped: boolean;\n    isPending: boolean;\n    lastReturnedValue: any;\n    lastThrownError: any;\n    loopStep: number;\n    deltaTimeStart?: [number, number];\n    deltaTime: number;\n}\n\n\n\n/**\n * The loop handler.\n * @internal\n * @private\n */\nexport default class Loop extends EventEmitter\n{\n    status: LoopStatus;\n\n    loopReturn: LoopReturn;\n    loopSelf: LoopSelf;\n\n    interval: number;\n    args: any[];\n\n    finishEventCalled: boolean = false;\n\n    protected loopHandler?: Promise<any> | ((this: LoopSelf, ...args: any[])=>any);\n\n    /**\n     * Constructor of the Loop class.\n     * @internal\n     */\n    constructor(handler: Promise<any> | ((this: LoopSelf, ...args: any[])=>any), interval: number, ...args: any[])\n    {\n        super();\n        this.setMaxListeners(50);\n\n        if(typeof interval !== \"number\")\n            throw new TypeError(\"Interval argument is not a number.\");\n\n        this.status = {\n            isStopped: true,\n            isPending: false,\n            lastThrownError: null,\n            lastReturnedValue: undefined,\n            loopStep: 1,\n            deltaTime: 0\n        };\n        \n        this.interval = interval;\n        this.args = args;\n\n        this.loopReturn = new LoopReturn(this);\n        this.loopSelf = new LoopSelf(this);\n\n        this.loopHandler = handler;\n\n        this.listenEvents();\n    }\n\n    measureTime(start?: [number, number]) {\n        if ( !start ) return process.hrtime();\n        var end = process.hrtime(start);\n        return Math.round((end[0]*1000) + (end[1]/1000000));\n    }\n\n    /**\n     * Runs the loop.\n     * @throws {\\Error} if loop is not stopped.\n     */\n    run()\n    {\n        if(this.status.isStopped){\n            this.emit('start');\n            this.status.isStopped = false;\n            this.executeStep();\n        } else {\n            throw new Error('Loop not stopped.');\n        }\n    }\n\n    /**\n     * Returns if loop is stopped.\n     */\n    isStopped()\n    {\n        if((this.status.isStopped || this.status.lastThrownError != null) && !this.finishEventCalled){\n            this.emit('beforeFinish');\n            this.emit('finish');\n            this.emit('afterFinish');\n            this.finishEventCalled = true;\n        }\n        return this.status.isStopped || this.status.lastThrownError != null;\n    }\n\n    /**\n     * Gets the loop return value.\n     */\n    getReturnValue()\n    {\n        return this.loopReturn;\n    }\n\n    /**\n     * Executes a step.\n     */\n    executeStep()\n    {\n        if(this.isStopped()) return;\n\n        this.emit('stepStart');\n        this.status.lastReturnedValue = undefined;\n\n        setTimeout(() => {\n            if(this.isStopped()) return;\n                \n            this.emit('beforeStepExecute');\n            this.emit('stepExecute');\n            this.emit('afterStepExecute');\n\n            var handler = this.loopHandler;\n            \n            if(typeof handler === \"function\")\n            {\n                try\n                {\n                    var value = handler.apply(this.loopSelf, ...this.args);\n                    if(this.status.lastReturnedValue === undefined){\n                        this.status.lastReturnedValue = value;\n                    }\n                    this.finishStep();\n                }\n                catch (error)\n                {\n                    this.status.lastThrownError = error;\n                    this.finishStep();\n                }\n            }\n\n            // TODO: Add a full support for Promises - this one is too restricted.\n            else if(typeof handler !== \"undefined\" && typeof handler.then === \"function\")\n            {\n                try\n                {\n                    var loop: any = handler.then((value: any) => {\n                        this.status.lastReturnedValue = value;\n                        this.finishStep();\n                    })\n                    if(typeof loop.catch === \"function\")\n                    {\n                        loop.catch((error: any) => {\n                            this.status.lastThrownError = error;\n                            this.finishStep();\n                        })\n                    }\n                }\n                catch (error)\n                {\n                    this.status.lastThrownError = error;\n                    this.finishStep();\n                }\n            }\n            else\n            {\n                throw new TypeError('Handler argument is not a function or a promise.');\n            }\n\n        }, this.interval);\n\n        return this;\n    }\n\n    /**\n     * Finishs the current step and starts a new step.\n     */\n    finishStep()\n    {  \n        if(!this.status.isPending)\n        {\n            this.emit('beforeStepFinish');\n            this.emit('stepFinish')\n            this.emit('afterStepFinish');\n        }\n\n        if(!this.isStopped() && !this.status.isPending)\n            this.executeStep();\n    }\n\n    /**\n     * Registers events.\n     */\n    listenEvents()\n    {\n        var status = this.status;\n        \n        this.on('stepStart', () => \n        {\n            this.status.deltaTimeStart = <[number, number]>this.measureTime();\n        })\n\n        this.on('stepFinish', () =>\n        {\n            this.status.deltaTime = <number>this.measureTime(this.status.deltaTimeStart);\n        });\n\n        this.on('afterStepFinish', () => \n        {\n            status.loopStep++;\n        })\n    }\n    \n}\n\n\n\n/**\n * Class used to interact inside of loop.\n * Primary used as scope ('this' reference) in loop handlers.\n * \n * @protected\n * @use_reference Never create the object yourself and always use reference.\n */\nexport class LoopSelf\n{\n\n    protected loop: Loop;\n\n    /**\n     * Current loop interval.\n     * @readonly\n     * @returns {number}\n     */\n    get interval(): number\n    {\n        return this.loop.interval;\n    }\n\n    /**\n     * Time difference between last step initialization and last step end.\n     * @readonly\n     * @returns {number}\n     */\n    get deltaTime(): number\n    {\n        return this.loop.status.deltaTime;\n    }\n\n    /**\n     * Current loop step.\n     * @readonly\n     * @returns {number}\n     */\n    get step(): number\n    {\n        return this.loop.status.loopStep;\n    }\n\n    /**\n     * Boolean indicating if the loop is stopped.\n     * @readonly\n     */\n    get isStopped()\n    {\n        return this.loop.isStopped();\n    }\n\n    /**\n     * Boolean indicating if the loop is pending.\n     * @readonly\n     */\n    get isPending()\n    {\n        return this.loop.status.isPending;\n    }\n\n    /**\n     * Value of the loop step.\n     */\n    set value(value: any)\n    {\n        this.loop.status.lastReturnedValue = value;\n    }\n    get value(): any\n    {\n        return this.loop.status.lastReturnedValue;\n    }\n\n    /**\n     * Constructor of the LoopSelf class.\n     * @hidden\n     */\n    constructor(loop: Loop)\n    {\n        this.loop = loop;\n\n        this.listenEvents();\n    }\n\n    /**\n     * Stop current loop.\n     */\n    stop(value?: any)\n    {\n        if(typeof value !== \"undefined\")\n            this.value = value;\n\n        this.loop.status.isStopped = true;\n    }\n\n    /**\n     * Start a subloop and pause current loop until the end of the subloop.\n     * @param handler The function to loop\n     * @param interval The interval in milliseconds\n     * @param args Some arguments to pass to function\n     * \n     * @see {@link LoopSelf} for handler scope ('this' reference).\n     */\n    startLoop(handler: Promise<any> | ((this: LoopSelf, ...args: any[])=>any), interval: number, ...args: any[])\n    {\n        return startLoop(handler, interval, ...args).parent(this.loop);\n    }\n\n    // EVENTS\n\n    /**\n     * Listen to events\n     * @ignore\n     */\n    protected listenEvents(){\n        //...\n    }\n    \n}\n\n\n\n/**\n * Class returned by loops.\n * \n * @protected\n * @use_reference Never create the object yourself and always use reference.\n */\nexport class LoopReturn extends EventEmitter implements PromiseLike<any>\n{\n    protected loop: Loop;\n    protected parentLoop?: Loop;\n\n    /**\n     * Constructor of the Loop class.\n     * @hidden\n     */\n    constructor(loop: Loop)\n    {\n        super();\n        this.setMaxListeners(Infinity);\n\n        this.loop = loop;\n        this.listenEvents();\n    }\n\n    /**\n     * Boolean indicating if the loop is stopped.\n     * @readonly\n     */\n    get isStopped()\n    {\n        return this.loop.isStopped();\n    }\n\n    /**\n     * Boolean indicating if the loop is pending.\n     * @readonly\n     */\n    get isPending()\n    {\n        return this.loop.status.isPending;\n    }\n\n    /**\n     * Starts or restarts the loop.\n     */\n    run()\n    {\n        this.loop.run();\n        return this;\n    }\n\n    /**\n     * Stops the loop.\n     */\n    stop()\n    {\n        this.loop.status.isStopped = true;\n    }\n\n    /**\n     * Sets a loop as parent, and set pending for the parent loop until the end of the loop.\n     * @param loop The parent loop\n     * @throws {\\Error} if parent is already defined.\n     */\n    parent(loop: Loop)\n    {\n        if(typeof this.parentLoop !== \"undefined\")\n            throw new Error(\"Parent is already set\");\n\n        this.parentLoop = loop;\n        this.parentLoop.status.isPending = true;\n        return this;\n    }\n\n    /**\n     * Starts a loop after the end of the current loop.\n     * @param handler The function to loop\n     * @param interval The interval in milliseconds\n     * @param args Some arguments to pass to function\n     * \n     * @see {@link LoopSelf} for handler scope ('this' reference).\n     */\n    startLoop(handler: Promise<any> | ((this: LoopSelf, ...args: any[])=>any), interval: number, ...args: any[])\n    {\n        var loop = registerLoop(handler, interval, ...args)\n\n        this.loop.once('finish', () => loop.run());\n\n        return loop;\n    }\n\n    /**\n     * Called when a loop is started.\n     */\n    start(callback: (loop: LoopSelf)=>void)\n    {\n        this.on('start', callback);\n\n        return this;\n    }\n\n    /**\n     * Called when a loop step is started.\n     */\n    stepStart(callback: (loop: LoopSelf)=>void, step?: number)\n    {\n        if(typeof step !== \"undefined\"){\n            var stepInt = parseInt(step.toString());\n            this.on('stepstart-' + stepInt, callback);\n        }else{\n            this.on('stepstart', callback);\n        }\n\n        return this;\n    }\n\n    /**\n     * Called when a loop step is finished.\n     */\n    step(callback: (loop: LoopSelf, value: any)=>void, step?: number)\n    {\n        if(typeof step !== \"undefined\"){\n            var stepInt = parseInt(step.toString());\n            this.on('step-' + stepInt, callback);\n        }else{\n            this.on('step', callback);\n        }\n\n        return this;\n    }\n\n    /**\n     * Called when the loop is terminated, even if there is an error.\n     */\n    terminated(callback: (value: any)=>any)\n    {\n        this.once('terminated', callback);\n\n        return this;\n    }\n\n    /**\n     * Called when the loop is stopped.\n     */\n    end(callback: (value: any)=>any, errorCallback?: (err: any)=>any)\n    {\n        this.once('end', callback);\n        if(typeof errorCallback !== \"undefined\")\n            this.error(errorCallback);\n\n        return this;\n    }\n\n    /**\n     * Alias for {@link end}: Called when the loop is stopped.\n     */\n    then(callback: (value: any)=>any, errorCallback: (err: any)=>any)\n    {\n        return this.end(callback, errorCallback);\n    }\n\n    /**\n     * Called when an uncaught error is thrown.\n     */\n    error(callback: (err: any)=>any)\n    {\n        this.once('error', callback);\n        return this;\n    }\n\n    /**\n     * Alias for {@link error}: Called when an uncaught error is thrown.\n     */\n    catch(callback: ()=>any)\n    {\n        return this.error(callback);\n    }\n\n    // EVENTS\n\n    /**\n     * Listen to events\n     * @ignore\n     */\n    protected listenEvents(){\n        var loop = this.loop;\n        var status = this.loop.status;\n\n        loop.on('start', () => \n        {\n            this.emit('start', loop.loopSelf);\n        });\n        loop.on('stepExecute', () =>\n        {\n            this.emit('stepstart', loop.loopSelf, status.lastReturnedValue);\n            this.emit('stepstart-' + status.loopStep, loop.loopSelf, status.lastReturnedValue);\n        });\n        loop.on('stepFinish', () =>\n        {\n            this.emit('step', loop.loopSelf, status.lastReturnedValue);\n            this.emit('step-' + status.loopStep, loop.loopSelf, status.lastReturnedValue);\n        });\n\n        loop.once('finish', () =>\n        {\n            if(status.lastThrownError != null)\n            {\n                this.emit('error', status.lastThrownError);\n            }\n            else\n            {\n                this.emit('end', status.lastReturnedValue);\n            }\n\n            this.emit('terminated', loop);\n\n            if(this.parentLoop != null){\n                this.parentLoop.status.isPending = false;\n                this.parentLoop.finishStep();\n            }\n        });\n    }\n    \n}\n"],"sourceRoot":"/home/pop/GitHub/KofiLoop/src"}